using System;
using System.Collections.Generic;
using MongoDB.Bson;
using MongoDB.Bson.Serialization.Attributes;

namespace XDR.Models.StaticAnalysis
{
    public sealed class StaticMalwareIncident
    {
        [BsonId]
        public ObjectId Id { get; set; }

        public ObjectId RawEventId { get; set; }

        public int stixObjectId { get; set; }

        public string EventType { get; init; } = "static_full";

        public DateTime Timestamp { get; init; }

        // Info file
        public string? Path { get; init; }
        public string? Name { get; init; }
        public string? FileType { get; init; }
        public int? StringsCount { get; init; }
        public string? Sha256 { get; init; }


        // IOC
        public List<string> Urls { get; init; } = new();
        public List<string> Ips { get; init; } = new();

        // Rating
        public int Score { get; init; }                 // 0..100
        public string Verdict { get; init; } = "UNKNOWN"; // LOW / MEDIUM / HIGH
        public bool IsIncident { get; init; }           // true se supera soglia

        // VT summary (utile in dashboard e per STIX)
        public bool VtMaliciousHit { get; init; }       // almeno 1 IOC malicious
        public bool VtSuspiciousHit { get; init; }      // almeno 1 IOC suspicious
        public List<VtIocFinding> VtFindings { get; init; } = new();

        // Explainability: perché hai alzato score
        public List<string> Reasons { get; init; } = new();
    }

    public sealed class VtIocFinding
    {
        public string Type { get; init; } = "";        // "ip" / "url"
        public string Value { get; init; } = "";
        public int Malicious { get; init; }
        public int Suspicious { get; init; }
        public int Harmless { get; init; }
        public int Undetected { get; init; }
        public int Timeout { get; init; }
        public bool FoundOnVt { get; init; }           // false se 404
    }
}
